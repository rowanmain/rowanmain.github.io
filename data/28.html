<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>book</title></head><body>зависимости

Стабильные абстракции      101

Принцип инверсии зависимости (Dependency Inversion Principle; DIP) ут-

верждает, что наиболее гибкими получаются системы, в которых зависимости 

в исходном коде направлены на абстракции, а не на конкретные реализации .

В языках со статической системой типов, таких как Java, это означает, что 

инструкции use, import и include должны ссылаться только на модули с ис-

ходным кодом, содержащим интерфейсы, абстрактные классы и другие 

абстрактные объявления . Никаких зависимостей от конкретных реализаций 

не должно быть .

То же правило действует для языков с динамической системой типов, таких 

как Ruby или Python . Исходный код не должен зависеть от модулей с кон-

кретной реализацией . Однако в этих языках труднее определить, что такое 

конкретный модуль . В частности, это любой модуль, в котором реализованы 

вызываемые функции .

Очевидно, что принять эту идею за правило практически невозможно, по-

тому что программные системы должны зависеть от множества конкретных 

особенностей . Например, String в Java — это конкретный класс и его невоз-

можно сделать абстрактным . Зависимости исходного кода от конкретного 

модуля java.lang.string невозможно и не нужно избегать .

С другой стороны, класс String очень стабилен . Изменения в этот класс 

вносятся крайне редко и жестко контролируются . Программистам и ар-

хитекторам не приходится беспокоиться о частых и непредсказуемых из-

менениях в String .

По этим причинам мы склонны игнорировать стабильный фундамент 

операционной системы и платформы, рассуждая о принципе инверсии за-

висимости . Мы терпим эти конкретные зависимости, потому что уверенно 

можем положиться на их постоянство .

Мы должны избегать зависимости от неустойчивых конкретных элементов 

системы . То есть от модулей, которые продолжают активно разрабатываться 

и претерпевают частые изменения .

Стабильные абстракции

Каждое изменение абстрактного интерфейса вызывает изменение его кон-

кретной реализации . Изменение конкретной реализации, напротив, не 

всегда сопровождается изменениями и даже обычно не требует изменений 

в соответствующих интерфейсах . То есть интерфейсы менее изменчивы, 

чем реализации .

102   Глава 11. Принцип инверсии зависимости

Действительно, хорошие дизайнеры и архитекторы программного обеспе-

чения всеми силами стремятся ограничить изменчивость интерфейсов . Они 

стараются найти такие пути добавления новых возможностей в реализации, 

которые не потребуют изменения интерфейсов . Это основа проектирования 

программного обеспечения .

Как следствие, стабильными называются такие архитектуры, в которых 

вместо зависимостей от переменчивых конкретных реализаций использу-

ются зависимости от стабильных абстрактных интерфейсов . Это следствие 

сводится к набору очень простых правил:

 

� Не ссылайтесь на изменчивые конкретные классы. Ссылайтесь на 

абстрактные интерфейсы . Это правило применимо во всех языках, не-

зависимо от устройства системы типов . Оно также накладывает важные 

ограничения на создание объектов и определяет преимущественное ис-

пользование шаблона «Абстрактная фабрика» .

 

� Не наследуйте изменчивые конкретные классы . Это естественное след-

ствие из предыдущего правила, но оно достойно отдельного упоминания . 

Наследование в языках со статической системой типов является самым 

строгим и жестким видом отношений в исходном коде; следовательно, его 

следует использовать с большой осторожностью . Наследование в языках 

с динамической системой типов влечет меньшее количество проблем, но 

все еще остается зависимостью, поэтому дополнительная предосторож-

ность никогда не помешает .

 

� Не переопределяйте конкретные функции. Конкретные функции часто 

требуют зависимостей в исходном коде . Переопределяя такие функции, 

вы не устраняете эти зависимости — фактически вы наследуете их . Для 

управления подобными зависимостями нужно сделать функцию аб-

страктной и создать несколько ее реализаций .

 

� Никогда не ссылайтесь на имена конкретных и изменчивых сущностей. 

В действительности это всего лишь перефразированная форма самого 

принципа .

Фабрики

Чтобы соблюсти все эти правила, необходимо предусмотреть особый способ 

создания изменчивых объектов . Это объясняется тем, что практически во 

всех языках создание объектов связано с образованием зависимостей на 

уровне исходного кода от конкретных определений этих объектов .

Фабрики      103

В большинстве объектно-ориентированных языков, таких как Java, для 

управления подобными нежелательными зависимостями можно использо-

вать шаблон «Абстрактная фабрика» .

Рисунок 11 .1 демонстрирует, как работает такая схема . Приложение 

Application использует конкретную реализацию ConcreteImpl через интер-

фейс Service . Однако приложению требуется каким-то образом создавать 

экземпляры ConcreteImpl . Чтобы решить эту задачу без образования зави-

симости от ConcreteImpl на уровне исходного кода, приложение вызывает 

метод makeSvc интерфейса фабрики ServiceFactory . Этот метод реализован 

в классе ServiceFactoryImpl, наследующем ServiceFactory . Эта реализация 

создает экземпляр ConcreteImpl и возвращает его как экземпляр интерфейса 

Service .

<<создает>>

Рис. 11.1. Использование шаблона «Абстрактная фабрика»  

для управления зависимостями

Извилистая линия на рис . 11 .1 обозначает архитектурную границу . Она от-

деляет абстракцию от конкретной реализации . Все зависимости в исходном 

коде пересекают эту границу в одном направлении — в сторону абстракции .

Извилистая линия делит систему на два компонента: абстрактный и кон-

кретный . Абстрактный компонент содержит все высокоуровневые бизнес-

правила приложения . Конкретный компонент содержит детали реализации 

этих правил .
</body></html>