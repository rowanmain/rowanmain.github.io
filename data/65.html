<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>book</title></head><body>рия, крупные корпоративные системы могут состоять из монолитных и ком-

понентных систем, а также из систем, состоящих из служб . То есть службы 

не единственный способ построения масштабируемых систем .

236   Глава 27. Службы: большие и малые

Во-вторых, как было показано в разделе «Заблуждение о независимости», 

службы не всегда могут разрабатываться, развертываться и эксплуатиро-

ваться независимо . Их разработку приходится координировать в той же 

мере, в какой они связаны данными или поведением .

Проблема с животными

Чтобы рассмотреть эти два заблуждения на примере, вернемся снова к на-

шей системе агрегатора такси . Как вы помните, эта система знает о несколь-

ких компаниях, предоставляющих услуги такси в данном городе, и позво-

ляет клиентам заказывать поездки . Представим, что клиенты выбирают 

такси по ряду критериев, таких как время ожидания, стоимость, комфорт 

и опытность водителя .

Мы решили для большей масштабируемости реализовать ее в виде мно-

жества маленьких микрослужб . Мы разделили большой коллектив раз-

работчиков на множество маленьких команд и каждой поручили раз-

работку, сопровождение и эксплуатацию соответствующего1 количества 

микрослужб .

Схема на рис . 27 .1 демонстрирует, как наши предполагаемые архитекторы 

распределили ответственность приложения между микрослужбами . Служба 

TaxiUI взаимодействует непосредственно с клиентом, заказывающим такси 

с помощью своего мобильного устройства . Служба TaxiFinder исследует 

параметры разных поставщиков услуг TaxiSupplier и выбирает возможных 

Список кандидатов

Рис. 27.1. Организация системы-агрегатора услуг такси в виде комплекса служб

1 Примерно по числу программистов в команде .

Проблема с животными      237

кандидатов для обслуживания клиента . Она собирает их во временной запи-

си, прикрепленной к данному пользователю . Служба TaxiSelector получает 

критерии, обозначенные пользователем, касающиеся стоимости, времени, 

комфорта и т . д ., и выбирает наиболее походящий вариант из списка кан-

дидатов . Затем она передает выбранный вариант службе TaxiDispatcher, 

которая оформляет заказ .

Теперь представим, что эта система работает уже больше года . Наши раз-

работчики успешно добавляют новые возможности, сопровождают и экс-

плуатируют все эти службы .

В один прекрасный солнечный день сотрудники отдела маркетинга орга-

низовали встречу с разработчиками . На этой встрече они объявили о своем 

решении организовать услугу по доставке котят . Как предполагается, кли-

енты смогут заказать доставку котят себе домой или на работу .

Компания создаст несколько пунктов сбора котят по всему городу, и когда 

поступит заказ, ближайшее такси заберет котенка в одном из пунктов сбора 

и доставит по указанному адресу .

Один из поставщиков услуг согласился участвовать в этой программе . 

Другие, скорее всего, последуют его примеру, а третьи могут отклонить 

предложение .

У некоторых водителей, как вы понимаете, может быть аллергия на кошек, 

поэтому их нельзя выбирать для выполнения таких заказов . Кроме того, 

у некоторых клиентов тоже может быть аллергия на кошек, поэтому для 

обслуживания тех, кто заявил об аллергии на кошек, не должны выбираться 

машины, осуществлявшие доставку котят в последние три дня .

А теперь взгляните на диаграмму служб и скажите, сколько из них придется 

изменить, чтобы реализовать описанную услугу? Все! Совершенно понятно, 

что разработка и развертывание услуги доставки котят должны быть тща-

тельно скоординированы .

Иными словами, все службы тесно связаны между собой и не могут разра-

батываться, развертываться и сопровождаться независимо .

Эта проблема свойственна всем сквозным задачам . С этой проблемой 

приходится сталкиваться любой системе, независимо от того, органи-

зована она в виде комплекса служб или нет . Системы, разделенные на 

службы по функциональному признаку, как показано на рис . 27 .1, очень 

уязвимы для новых особенностей, пересекающих все эти функциональные 

уровни .

238   Глава 27. Службы: большие и малые

Спасение в объектах

Как бы мы решили эту проблему в архитектуре, состоящей из компонентов? 

Неуклонное следование принципам проектирования SOLID вынудило бы 

нас создать набор классов, которые можно было бы полиморфно расширять 

под потребности новых возможностей .

Схема на рис . 27 .2 демонстрирует эту стратегию . Классы на этой схеме 

примерно соответствуют службам на рис . 27 .1 . Но обратите внимание на 

границы . Отметьте также, что все зависимости оформлены в соответствии 

с правилом зависимостей .

Фабрики

компонентов

Рис. 27.2. Использование объектно-ориентированного подхода для преодоления 

проблемы сквозных задач

Службы на основе компонентов      239

Большая часть логики оригинальных служб сосредоточена в базовых клас-

сах объектной модели . Однако часть логики, связанная с поездками, выде-

лена в компонент Rides . Реализация новой услуги по доставке котят поме-

щена в отдельный компонент Kittens . Эти два компонента переопределяют 

абстрактные базовые классы из оригинальных компонентов с применением 

шаблонов, таких как «Шаблонный метод» или «Стратегия» .

Отметим еще раз, что два новых компонента, Rides и Kittens, подчиняются 

правилу зависимостей . Обратите также внимание, что классы, реализующие 

эти возможности, создаются фабриками под управлением пользовательского 

интерфейса .

Ясно, что в этой схеме после реализации Kittens придется изменить TaxiUI . 

Но все остальное останется в прежнем виде . В систему добавится лишь 

новый файл jar, Gem или DLL, который будет динамически загружаться во 

время выполнения системы .

То есть компонент Kittens существует отдельно от других и может разраба-

тываться и развертываться независимо .

Службы на основе компонентов

Возникает резонный вопрос: можно ли реализовать нечто подобное 

для служб? И ответ, конечно, да! Службы не обязательно должны быть 

маленькими монолитами . Службы также могут проектироваться в соот-
</body></html>