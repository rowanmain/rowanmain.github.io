<!DOCTYPE html>
<html>
<head>
   <title>Моя статья</title>
   <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<style>
body {
   background-color: #f0f0f0;
   font-family: Arial, sans-serif;
}

header {
   background-color: #333;
   color: white;
   padding: 10px;
   text-align: center;
}

h1 {
   margin: 0;
}

article {
   margin: 20px;
}

h2 {
   color: #333;
}

p {
   line-height: 1.6;
}
</style>
<body>
   <header>
       <h1>статья</h1>
   </header>
   <article>
       <p>
Language; BPEL).

338   Приложение. Архитектурная археология

Старый прием использования дисковых файлов для взаимодействий между 

службами, реализованный в электронном секретаре, был слишком медленным 

для этих быстро сменяющих друг друга служб, поэтому мы изобрели механизм 

общей памяти, который назвали 3DBB1. Механизм 3DBB позволял обращаться 

к данным по именам; в качестве имен использовались названия, присвоенные 

экземплярам машины состояний.

Общая память прекрасно подходила для хранения строк и констант, но ее 

нельзя было использовать для хранения сложных структур данных. При-

чина была чисто технической. Каждый процесс в MP/M находился в соб-

ственном сегменте памяти. Указатели на данные в одном сегменте не 

имели смысла в другом. Как следствие, данные в общей памяти не могли 

содержать указатели. Строки можно хранить без ограничений, но деревья, 

связные списки и любые другие структуры данных с указателями — нет.

Система заявок получала заявки из разных источников. Некоторые добавля-

лись автоматически, некоторые — вручную. Заявки, добавляемые вручную, 

создавались операторами, общавшимися с клиентами. По мере того как клиент 

описывал проблему, оператор вводил жалобы и наблюдения в структурирован-

ный поток текста. Он выглядел примерно так:

/pno 8475551212 /noise /dropped-calls

Идея должна быть понятна. Символ / начинал новую тему. За этим символом 

следовал код, за кодом — параметры. Таких кодов были тысячи, а в описании 

каждой заявки их могло быть до нескольких десятков. Хуже того, операторы 

часто допускали опечатки или ошибались в форматировании. Люди прекрасно 

справлялись с интерпретацией таких заявок, но не машины.

Перед нами стояла задача — декодировать эти строки, интерпретировать, испра-

вить возможные ошибки и преобразовать их в голосовые сообщения, которые 

могли бы прослушивать ремонтники по телефону. Для этого кроме всего прочего 

требовалось реализовать очень гибкий анализ и формат представления данных. 

Данные в этом формате должны были передаваться через общую память, кото-

рая могла обслуживать только строки.

Итак, в короткие перерывы между посещениями клиентов я изобрел схему, 

которую назвал FLD: Field Labeled Data (данные с маркированными полями). 

В наши дни мы назвали бы этот формат XML или JSON. Формат представле-

ния отличался, но идея была той же. Схема FLD представляла данные в виде 

бинарного дерева, которые ассоциировали имена с данными в рекурсивной 

иерархии. Данные в формате FLD можно было получить с применением про-

1 Three-Dimensional Black Board — трехмерная черная доска. Если вы родились 

в 1950-х годах, вам наверняка более знакомой покажется фраза: Drizzle, Drazzle, 

Druzzle, Drone.

Система командирования ремонтников   339

стого API и преобразовать в строковое представление, идеально подходящее 

для передачи через общую память.

То есть уже в 1985 году микрослужбы обменивались информацией через общую 

память — аналог сокетов, — используя формат, аналогичный XML.

Ничто не ново под луной.

Clear Communications

В 1988 году группа сотрудников Teradyne покинула компанию, чтобы основать 

новую фирму под названием Clear Communications. Я присоединился к ним не-

сколькими месяцами позже. Нашей целью было создание программного обеспе-

чения для системы, осуществлявшей контроль качества связи по линиям T1 — 

цифровым линиям для междугородной связи по всей стране. Мы видели ее как 

огромный монитор с картой США и пересекающей ее сеткой линий T1, которые 

начинали мигать красным, если обнаруживались проблемы.

В 1988 году графические пользовательские интерфейсы только стали появлять-

ся. Модели Apple Macintosh было всего пять лет. Windows в ту пору не стоила 

доброго слова. Но компания Sun Microsystems строила станции Sparc, имевшие 

превосходный графический интерфейс X-Window. Поэтому мы пошли с Sun, 

а значит, с языком C и операционной системой UNIX.

Это был период становления новой компании. Мы работали по 70–80 часов 

в неделю. У нас было в�идение. У нас была мотивация. У нас была воля. У нас 

была энергия. У нас был опыт. Мы были равны. Мы мечтали стать миллионе-

рами. Мы были безрассудны.

Код на C лился из нас как из рога изобилия. Мы вталкивали и впихивали его то 

туда, то сюда. Мы строили огромные воздушные замки. У нас были процессы, оче-

реди сообщений и великолепные архитектуры. Мы написали семиуровневый ISO-

стек взаимодействий с нуля — вплоть до канального уровня передачи данных.

Мы писали код графического интерфейса. ГРЯЗНЫЙ КОД! Бог мой! Мы пи-

сали СЛИШКОМ ГРЯЗНЫЙ КОД.

Я лично написал на C функцию с именем gi() длиной в 3000 строк; ее имя рас-

шифровывалось как Graphic Interpreter (графический интерпретатор). Это был 

шедевр грязи. Это не единственный грязный код, который я написал в Clear, но 

этот был самым позорным.

Архитектура? Вы шутите? Это был период становления. У нас не было време-

ни на архитектуру. Только код, черт возьми! Код, от которого зависело наше 

будущее благополучие!

Поэтому мы писали, писали и писали код. А через три года мы прогорели. Нет, 

мы смогли продать один или два экземпляра системы. Но рынок не особенно 

340   Приложение. Архитектурная археология

интересовался нашим грандиозным видением, и наши инвесторы были уже 

сыты по горло.

В тот момент я ненавидел свою жизнь. Я видел, как прахом идут все мои усилия 

и рушатся мои мечты. У меня стали возникать конфликты на работе, конфликты 

дома из-за работы и конфликты с самим собой.

И тогда я принял телефонный звонок, который все изменил.

Обстановка

За два года до этого звонка произошло два важных события.

Во-первых, мне удалось настроить uucp-соединение с соседней компанией, 

имевшей uucp-соединение с другим объектом, подключенным к Интернету. Это, 

конечно же, были коммутируемые соединения. Наша основная Sparc-станция 

(стоявшая на моем рабочем столе) использовала модем со скоростью передачи 

1200 бит/с для соединения с нашим uucp-хостом дважды в день. Это дало нам 

электронную почту и доступ к Netnews (первой социальной сети, где люди об-

суждали разные интересные вопросы).

Во-вторых, Sun выпустила компилятор C++. Я интересовался языком C++ 

и объектно-ориентированным программированием начиная с 1983 года, но ком-

пилятор тогда было трудно найти. Поэтому, как только представилась возмож-

ность, я сразу же сменил язык. Я оставил функции на C из 3000 строк и начал 

писать код на C++ для Clear. И я учился...

</p>
   </article>
</body>
</html>
