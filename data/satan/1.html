<!DOCTYPE html>
<html>
<head>
   <title>Моя статья</title>
   <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<style>
body {
   background-color: #f0f0f0;
   font-family: Arial, sans-serif;
}

header {
   background-color: #333;
   color: white;
   padding: 10px;
   text-align: center;
}

h1 {
   margin: 0;
}

article {
   margin: 20px;
}

h2 {
   color: #333;
}

p {
   line-height: 1.6;
}
</style>
<body>
   <header>
       <h1>статья</h1>
   </header>
   <article>
       <p>
2021

ББК 32.973.2-018

УДК 004.3

М29

 

Мартин Р.

М29 

Чистая архитектура. Искусство разработки программного обеспечения. — 

СПб.: Питер, 2021. — 352 с.: ил. — (Серия «Библиотека программиста»).

 

ISBN 978-5-4461-0772-8

«Идеальный программист» и «Чистый код» — легендарные бестселлеры Роберта Мартина — 

рассказывают, как достичь высот профессионализма. «Чистая архитектура» продолжает эту тему, 

но не предлагает несколько вариантов в стиле «решай сам», а объясняет, что именно следует 

делать, по какой причине и почему именно такое решение станет принципиально важным для 

вашего успеха.

Роберт Мартин дает прямые и лаконичные ответы на ключевые вопросы архитектуры и дизай-

на. «Чистую архитектуру» обязаны прочитать разработчики всех уровней, системные аналитики, 

архитекторы и каждый программист, который желает подняться по карьерной лестнице или хотя 

бы повлиять на людей, которые занимаются данной работой.

16+ (В соответствии с Федеральным законом от 29 декабря 2010 г. № 436-ФЗ.)

 

ББК 32.973.2-018

 

УДК 004.3

Информация, содержащаяся в данной книге, получена из источников, рассматриваемых издательством как 

надежные. Тем не менее, имея в виду возможные человеческие или технические ошибки, издательство не 

может гарантировать абсолютную точность и полноту приводимых сведений и не несет ответственности за 

возможные ошибки, связанные с использованием книги. Издательство не несет ответственности за доступ-

ность материалов, ссылки на которые вы можете найти в этой книге. На момент подготовки книги к изданию 

все ссылки на интернет-ресурсы были действующими. 

ISBN 978-0134494166 англ. 

© 2018 Pearson Education, Inc.

ISBN 978-5-4461-0772-8 

© Перевод на русский язык ООО Издательство «Питер», 2021

 

© Издание на русском языке, оформление ООО Издательство 

 

    «Питер», 2021

 

© Серия «Библиотека программиста», 2021

Права на издание получены по соглашению с Pearson Education Inc. Все права защищены. Никакая часть 

данной книги не может быть воспроизведена в какой бы то ни было форме без письменного разрешения 

владельцев авторских прав. 

Оглавление

Предисловие  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  14

От издательства  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 17

Вступление  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  18

Благодарности  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  21

Об авторе  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  22

Часть I. Введение .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 23

Глава 1. Что такое дизайн и архитектура?  . . . . . . . . . . . . . . . . . . . . . . . 25

Цель?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  26

Пример из практики  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  27

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  33

Глава 2. История о двух ценностях  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35

Поведение   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  36

Архитектура   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  36

Наибольшая ценность   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  37

Матрица Эйзенхауэра   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  38

Битва за архитектуру  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  39

Часть II. Начальные основы: парадигмы программирования . . . 41

Глава 3. Обзор парадигм . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43

Структурное программирование   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  44

Объектно-ориентированное программирование   .  .  .  .  .  .  .  .  .  .  .  .  .  .  44

Функциональное программирование  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  45

Пища для ума   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  45

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  46

https://t.me/it_boooks

6   Оглавление

Глава 4. Структурное программирование  . . . . . . . . . . . . . . . . . . . . . . . . 47

Доказательство  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  48

Объявление вредным  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  50

Функциональная декомпозиция   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  51

Формальные доказательства отсутствуют   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  51

Наука во спасение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  52

Тестирование  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  52

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  53

Глава 5. Объектно-ориентированное программирование  . . . . . . . . . . . 54

Инкапсуляция?   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  55

Наследование?   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  58

Полиморфизм?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  60

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  66

Глава 6. Функциональное программирование  . . . . . . . . . . . . . . . . . . . . 67

Квадраты целых чисел  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  68

Неизменяемость и архитектура   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  69

Ограничение изменяемости  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  70

Регистрация событий  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  72

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  73

Часть III. Принципы дизайна .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 75

Глава 7. Принцип единственной ответственности  . . . . . . . . . . . . . . . . . 78

Признак 1: непреднамеренное дублирование   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  80

Признак 2: слияния  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  81

Решения   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  82

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  84

Глава 8. Принцип открытости/закрытости  . . . . . . . . . . . . . . . . . . . . . . . 85

Мысленный эксперимент  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  86

Управление направлением  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  90

Сокрытие информации   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  90

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  90

Глава 9. Принцип подстановки Барбары Лисков  . . . . . . . . . . . . . . . . . . 91

Руководство по использованию наследования  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  92

Проблема квадрат/прямоугольник  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  92

Содержание      7

LSP и архитектура  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  93

Пример нарушения LSP   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  94

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  95

Глава 10. Принцип разделения интерфейсов  . . . . . . . . . . . . . . . . . . . . . 96

Принцип разделения интерфейсов и язык  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  98

Принцип разделения интерфейсов и архитектура  .  .  .  .  .  .  .  .  .  .  .  .  98

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  99

Глава 11. Принцип инверсии зависимости  . . . . . . . . . . . . . . . . . . . . . . 100

Стабильные абстракции   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 101

Фабрики  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 102

Конкретные компоненты   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 104

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 104

Часть IV. Принципы организации компонентов . . . . . . . . . . . . . . 105

Глава 12. Компоненты . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106

Краткая история компонентов   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 107

Перемещаемость   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 110

Компоновщики  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 110

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 112

Глава 13. Связность компонентов  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113

Принцип эквивалентности повторного использования  

и выпусков  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 114

Принцип согласованного изменения   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 115

Принцип совместного повторного использования   .  .  .  .  .  .  .  .  .  . 117

Диаграмма противоречий для определения связности  

компонентов   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 118

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 119

Глава 14. Сочетаемость компонентов  . . . . . . . . . . . . . . . . . . . . . . . . . . 121

Принцип ацикличности зависимостей   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 122

Проектирование сверху вниз  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 128

Принцип устойчивых зависимостей  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 129

Принцип устойчивости абстракций   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 135

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 142

8   Оглавление

Часть V. Архитектура .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 143

Глава 15. Что такое архитектура  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 144

Разработка  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 146

Развертывание   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 146

Эффективность работы  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 147

Сопровождение   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 148

Сохранение разнообразия вариантов  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 148

Независимость от устройства  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 150

Нежелательная почта  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 152

Физическая адресация  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 153

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 154

Глава 16. Независимость  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 155

Варианты использования  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 156

Эффективность работы  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 156

Разработка  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 157

Развертывание   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 157

Сохранение разнообразия вариантов  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 158

Разделение уровней   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 158

Разделение вариантов использования  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 159

Режим разделения  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 160

Возможность независимой разработки   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 161

Возможность независимого развертывания  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 161

Дублирование  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 162

Режимы разделения (еще раз)   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 163

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 165

Глава 17. Границы: проведение разделяющих линий . . . . . . . . . . . . . . 166

Пара печальных историй   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 167

FitNesse  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 170

Какие границы проводить и когда?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 172

О вводе и выводе  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 175

Архитектура с плагинами  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 176

Аргумент в пользу плагинов   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 177

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 178

Оглавление

     

9

Глава 18. Анатомия границ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179

Пересечение границ   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 180

Ужасный монолит  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 180

Компоненты развертывания   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 182

Потоки выполнения  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 183

Локальные процессы   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 183

Службы  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 184

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 185

Глава 19. Политика и уровень . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 186

Уровень  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 187

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 190

Глава 20. Бизнес-правила  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 191

Сущности  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 192

Варианты использования  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 193

Модели запросов и ответов   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 195

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 196

Глава 21. Кричащая архитектура . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 197

Тема архитектуры   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 198

Цель архитектуры  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 199

А что насчет Веб?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 199

Фреймворки — это инструменты, а не образ жизни   .  .  .  .  .  .  .  .  . 200

Тестируемые архитектуры   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 200

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 201

Глава 22. Чистая архитектура  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 202

Правило зависимостей   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 204

Типичный сценарий   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 208

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 209

Глава 23. Презентаторы и скромные объекты  . . . . . . . . . . . . . . . . . . . 210

Шаблон «Скромный объект»   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 211

Презентаторы и представления   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 211

Тестирование и архитектура   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 212

Шлюзы к базам данных  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 212

10   Оглавление

Преобразователи данных   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 213

Службы  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 214

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 214

Глава 24. Неполные границы  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 215

Пропустить последний шаг   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 216

Одномерные границы   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 217

Фасады   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 217

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 218

Глава 25. Уровни и границы  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219

Охота на Вампуса   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 220

Чистая архитектура?   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 221

Пересечение потоков   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 224

Разбиение потоков   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 224

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 226

Глава 26. Главный компонент . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 228

Конечная деталь  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 229

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 232

Глава 27. Службы: большие и малые . . . . . . . . . . . . . . . . . . . . . . . . . . . 233

Сервисная архитектура?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 234

Преимущества служб?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 234

Проблема с животными  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 236

Спасение в объектах  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 238

Службы на основе компонентов  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 239

Сквозные задачи   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 240

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 241

Глава 28. Границы тестов  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 242

Тесты как компоненты системы  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 243

Проектирование для простоты тестирования   .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 244

Программный интерфейс для тестирования   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 245

Безопасность  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 245

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 246

 Оглавление      11

Глава 29. Чистая встраиваемая архитектура  . . . . . . . . . . . . . . . . . . . . 247

Тест на профпригодность   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 250

Привязка к оборудованию — узкое место  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 253

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 264

Часть VI. Детали . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 265

Глава 30. База данных — это деталь . . . . . . . . . . . . . . . . . . . . . . . . . . . . 266

Реляционные базы данных  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 267

Почему системы баз данных настолько распространены?   .  .  . 268

Сохранятся ли диски?   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 269

Детали  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 270

А производительность?  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 270

История   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 270

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 272

Глава 31. Веб — это деталь  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 273

Бесконечный маятник  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 274

Вывод  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 276

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 277

Глава 32. Фреймворки — это деталь  . . . . . . . . . . . . . . . . . . . . . . . . . . . 278

Авторы фреймворков  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 279

Неравный брак  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 279

Риски  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 280

Решение   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 280

Объявляю вас   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 281

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 281

Глава 33. Практический пример: продажа видео  . . . . . . . . . . . . . . . . . 282

Продукт  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 283

Анализ вариантов использования   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 283

Компонентная архитектура  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 285

Управление зависимостями  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 286

Заключение  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 287

12    Оглавление

Глава 34. Недостающая глава . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 288

Упаковка по уровням . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 289

Упаковка по особенностям . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 290

Порты и адаптеры  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 291

Упаковка по компонентам   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 293

Дьявол в деталях реализации   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 298

Организация и инкапсуляция . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 299

Другие режимы разделения . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 302

Заключение: недостающий совет . . . . . . . . . . . . . . . . . . . . . . . . . . . 304

Часть VII. Приложение . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 305

Архитектурная археология   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 306

Профсоюзная система учета   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 307

Laser Trim . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 314

Контроль алюминиевого литья под давлением . . . . . . . . . . . . . . 317

4-TEL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 318

Компьютер зоны обслуживания . . . . . . . . . . . . . . . . . . . . . . . . . . . . 322

Язык C . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 326

BOSS   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 328

pCCU . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 328

DLU/DRU . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 330

VRS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 332

Электронный секретарь   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 334

Система командирования ремонтников   . . . . . . . . . . . . . . . . . . . . 336

ROSE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 342

Регистрационные экзамены для архитекторов . . . . . . . . . . . . . . 344

Заключение . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 347

Послесловие . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 348

Посвящается моей любимой супруге,  

моим четырем замечательным детям  

и их семьям, включая пятерых внуков —  

радость моей жизни

Предисловие

О чем мы говорим, когда обсуждаем архитектуру?

Так же как любая метафора, описание программного обеспечения с точки 

зрения архитектуры может что-то скрыть, а что-то, наоборот, проявить; мо-

жет обещать больше, чем давать, и давать больше, чем обещать .

Очевидная привлекательность архитектуры — это структура . А структура — 

это то, что доминирует над парадигмами и суждениями в мире разработки 

программного обеспечения — компонентами, классами, функциями, модуля-

ми, слоями и службами, микро или макро . Но макроструктура многих про-

граммных систем часто пренебрегает убеждениями или пониманием — ор-

ганизация советских предприятий, невероятные небоскребы-башни Дженга, 

достигающие облаков, археологические слои, залегающие в горной породе . 

Структура программного обеспечения не всегда интуитивно очевидна, как 

структура зданий .

Здания имеют очевидную физическую структуру, независимо от материала, 

из которого они построены, от их высоты или ширины, от их назначения 

и от наличия или отсутствия архитектурных украшений . Их структура мало 

чем отличается — в значительной мере она обусловлена законом тяготения 

и физическими свойствами материалов . Программное обеспечение, напро-

тив, никак не связано с тяжестью, кроме чувства серьезности . И из чего же 

сделано программное обеспечение? В отличие от зданий, которые могут 

быть построены из кирпича, бетона, дерева, стали и стекла, программное 

обеспечение строится из программных компонентов . Большие программные 

конструкции создаются из меньших программных компонентов, которые, 

в свою очередь, построены из еще более мелких программных компонентов, 

и т . д ., вплоть до основания .

Говоря об архитектуре, можно сказать, что программное обеспечение по 

своей природе является фрактальным и рекурсивным, выгравированным 

и очерченным в коде . Здесь важны все детали . Переплетение уровней дета-

Предисловие

     

15

лизации также вносит свой вклад в архитектуру, но бессмысленно говорить 

о программном обеспечении в физических масштабах . Программное обеспе-

чение имеет структуру — множество структур и множество их видов, — но 

их разнообразие затмевает диапазон физических структур, которые можно 

увидеть на примере зданий . Можно даже довольно убедительно утверждать, 

что при проектировании программного обеспечения архитектуре уделяется 

куда больше внимания, чем при проектировании зданий, — в этом смысле 

архитектура программного обеспечения является более многообразной, чем 

архитектура зданий!

Но физический масштаб привычнее людям, и они часто ищут его в окру-

жающем мире . Несмотря на привлекательность и визуальную очевидность, 

прямоугольники на диаграммах PowerPoint не являются архитектурой 

программного обеспечения . Да, они представляют определенный взгляд 

на архитектуру, но принимать прямоугольники за общую картину, отража-

ющую архитектуру, значит не получить ни общей картины, ни понятия об 

архитектуре: архитектура программного обеспечения ни на что не похожа . 

Конкретный способ визуализации — не более чем частный выбор . Этот вы-

бор основан на следующем наборе вариантов: что включить; что исключить; 

что подчеркнуть формой или цветом; что, наоборот, затенить . Никакой 

взгляд не имеет никаких преимуществ перед другим .

Возможно, нет смысла говорить о законах физики и физических масштабах 

применительно к архитектуре программного обеспечения, но мы действи-

тельно учитываем некоторые физические ограничения . Скорость работы 

процессора и пропускная способность сети могут вынести суровый при-

говор производительности . Объем памяти и дискового пространства может 

ограничить амбиции любого программного кода . Программное обеспечение 

можно сравнить с такой материей, как мечты, но ему приходится работать 

в реальном, физическом мире .

В любви, дорогая, чудовищна только безграничность воли, безграничность 

желаний, несмотря на то, что силы наши ограничены, а осуществление меч-

ты — в тисках возможности.

Вильям Шекспир1

Физический мир — это мир, в котором мы живем, в котором находятся 

и действуют наши компании и экономика . Это дает нам другой подход к по-

ниманию архитектуры программного обеспечения, позволяющий говорить 

и рассуждать не в терминах физических законов и понятий .

1 Перевод Т . Гнедич . — Примеч. ред .

16   Предисловие

Архитектура отражает важные проектные решения по формированию си-

стемы, где важность определяется стоимостью изменений.

Гради Буч

Время, деньги, трудозатраты — вот еще одна система координат, помогаю-

щая нам различать большое и малое и отделять относящееся к архитектуре 

от всего остального . Она также помогает дать качественную оценку архитек-

туре — хорошая она или нет: хорошая архитектура отвечает потребностям 

пользователей, разработчиков и владельцев не только сейчас, но и продол-

жит отвечать им в будущем .

Если вы думаете, что хорошая архитектура стоит дорого, попробуйте плохую 

архитектуру.

Брайан Фут и Джозеф Йодер

Типичные изменения, происходящие в процессе разработки системы, не 

должны быть дорогостоящими, сложными в реализации; они должны укла-

дываться в график развития проекта и в рамки дневных или недельных 

заданий .

Это ведет нас прямиком к большой физической проблеме: путешествиям 

во времени . Как узнать, какие типичные изменения будут происходить, 

чтобы на основе этого знания принять важные решения? Как уменьшить 

трудозатраты и стоимость разработки без машины времени и гадания на 

кофейной гуще?

Архитектура — это набор верных решений, которые хотелось бы принять 

на ранних этапах работы над проектом, но которые не более вероятны, чем 

другие .

Ральф Джонсон

Анализ прошлого сложен; понимание настоящего в лучшем случае пере-

менчиво; предсказание будущего нетривиально .

К цели ведет много путей .

На самом темном пути подстерегает мысль, что прочность и стабильность 

архитектуры зависят от строгости и жесткости . Если изменение оказыва-

ется слишком дорогостоящим, оно отвергается — его причины отменяются 

волевым решением . Архитектор имеет полную и безоговорочную власть, 

а архитектура превращается в антиутопию для разработчиков и постоянный 

источник недовольств .

От издательства      17

От другого пути исходит сильный запах спекулятивной общности . Он по-

лон догадок, бесчисленных параметров, могильников с «мертвым» кодом 

и на нем подкарауливает множество случайных сложностей, способных 

покачнуть бюджет, выделенный на обслуживание .

Но самый интересный — третий, чистый путь . Он учитывает природную 

гибкость программного обеспечения и стремится сохранить ее как основное 

свойство системы . Он учитывает, что мы оперируем неполными знаниями 

и, будучи людьми, неплохо приспособились к этому . Он играет больше на 

наших сильных сторонах, чем на слабостях . Мы создаем что-то и совершаем 

открытия . Мы задаем вопросы и проводим эксперименты . Хорошая архитек-

тура основывается скорее на понимании движения к цели как непрерывного 

процесса исследований, а не на понимании самой цели как зафиксирован-

ного артефакта .

Архитектура — это гипотеза, которую требуется доказать реализацией 

и оценкой.

Том Гилб

Чтобы пойти по этому пути, нужно быть усердным и внимательным, нужно 

уметь думать и наблюдать, приобретать практические навыки и осваивать 

принципы . Сначала кажется, что это долгий путь, но в действительности все 

зависит от темпа вашей ходьбы .

Поспешай не торопясь.

Роберт С. Мартин

Получайте удовольствие от путешествия .

Кевлин Хенни 

май, 2017

От издательства

Ваши замечания, предложения, вопросы отправляйте по адресу comp@piter.

com (издательство «Питер», компьютерная редакция) .

Мы будем рады узнать ваше мнение!

На веб-сайте издательства www.piter.com вы найдете подробную информацию 

о наших книгах .

Вступление

Эта книга называется «Чистая архитектура» . Смелое название . Кто-то по-

считает его самонадеянным . Почему я решил написать эту книгу и выбрал 

такое название?

Свою первую строку кода я написал в 1964 году, в 12 лет . Сейчас на кален-

даре 2016-й, то есть я пишу код уже больше полувека . За это время я кое-

что узнал о структурировании программных систем, и мои знания, как мне 

кажется, многие посчитали бы ценными .

Я приобрел эти знания, создав множество систем, больших и маленьких . 

Я создавал маленькие встраиваемые системы и большие системы пакетной 

обработки, системы реального времени и веб-системы, консольные прило-

жения, приложения с графическим интерфейсом, приложения управления 

процессами, игры, системы учета, телекоммуникационные системы, инстру-

менты для проектирования, графические редакторы и многое, многое другое .

Я писал однопоточные и многопоточные приложения, приложения с не-

сколькими тяжеловесными процессами и приложения с большим ко-

личеством легковесных процессов, многопроцессорные приложения, 

приложения баз данных, приложения для математических вычислений 

и вычислительной геометрии и многие, многие другие .

Я написал очень много приложений, я создал очень много систем . И благо-

даря накопленному опыту я пришел к потрясающему выводу:

Все архитектуры подчиняются одним и тем же правилам!

Потрясающему, потому что все системы, в создании которых я участвовал, 

радикально отличались друг от друга . Почему архитектуры таких разных 

систем подчиняются одним и тем же правилам? Я пришел к выводу, что 

правила создания архитектур не зависят от любых других переменных .

Этот вывод кажется еще более потрясающим, если вспомнить, как изме-

нились компьютеры за те же полвека . Я начинал программировать на ма-

шинах размером с холодильник, имевших процессоры с тактовой частотой 

в полмегагерца, 4 Кбайт оперативной памяти, 32 Кбайт дисковой памяти 

Вступление      19

и интерфейс телетайпа со скоростью передачи данных 10 символов в секун-

ду . Это вступление я написал в автобусе, путешествуя по Южной Африке . 

Я использовал MacBook, оснащенный процессором i7 с четырьмя ядрами, 

каждое из которых действует на тактовой частоте 2,8 ГГц, имеющий 16 Гбайт 

оперативной памяти, 1 Тбайт дисковой памяти (на устройстве SSD) и ди-

сплей с матрицей 2880×1800, способный отображать высококачественное 

видео . Разница в вычислительной мощности умопомрачительная . Любой 

анализ покажет, что этот MacBook по меньшей мере в 1022 раз мощнее ран-

них компьютеров, на которых я начинал полвека назад .

Двадцать два порядка — очень большое число . Это число ангстремов от 

Земли до альфы Центавра . Это количество электронов в мелких монетах 

в вашем кармане или кошельке . И еще это число описывает, во сколько раз 

(как минимум) увеличилась вычислительная мощность компьютеров на 

моем веку .

А как влиял рост вычислительной мощности на программы, которые мне 

приходилось писать? Определенно они стали больше . Раньше я думал, что 

2000 строк — это большая программа . В конце концов, такая программа за-

нимала полную коробку перфокарт и весила 4,5 килограмма . Однако теперь 

программа считается по-настоящему большой, только если объем кода пре-

высит 100 000 строк .

Программное обеспечение также стало значительно более производитель-

ным . Сегодня мы можем быстро выполнять такие вычисления, о которых 

и не мечтали в 1960-х . В произведениях The Forbin Project1, The Moon Is a 

Harsh Mistress2 и 2001: A Space Odyssey3 была сделана попытка изобразить 

наше текущее будущее, но их авторы серьезно промахнулись . Все они изо-

бражали огромные машины, обладающие чувствами . В действительности мы 

имеем невероятно маленькие машины, которые все же остаются машинами .

И еще одно важное сходство современного программного обеспечения 

и прошлого программного обеспечения: и то и другое сделано из того же 

материала . Оно состоит из инструкций if, инструкций присваивания 

и циклов while .

Да, вы можете возразить, заявив, что современные языки программирова-

ния намного лучше и поддерживают превосходящие парадигмы . В конце 

1 Фильм, вышедший в США в 1970 году, в нашей стране известный под названием 

«Колосс: Проект Форбина» . — Примеч. пер.

2 «Луна жестко стелет», роман Роберта Хайнлайна . — Примеч. пер.

3 Фильм, вышедший в 1968 году, в нашей стране известный под названием «2001 год: 

Космическая одиссея» . — Примеч. пер.

20   Вступление

концов, мы программируем на Java, C# или Ruby и используем объектно-

ориентированную парадигму . И все же программный код до сих пор состоит 

из последовательностей операций, условных инструкций и итераций, как 

в 1950-х и 1960-х годах .

Внимательно рассмотрев практику программирования компьютеров, вы 

заметите, что очень немногое изменилось за 50 лет . Языки стали немного 

лучше . Инструменты стали фантастически лучше . Но основные строитель-

ные блоки компьютерных программ остались прежними .

Если взять программиста из 1966 года, переместить ее1 в 2016-й, посадить 

за мой MacBook, запустить IntelliJ и показать ей Java, ей потребовались бы 

лишь сутки, чтобы оправиться от шока . А затем она смогла бы писать со-

временные программы . Язык Java не сильно отличается от C или даже от 

Fortran .

И если вас переместить обратно в 1966-й год и показать, как писать и пра-

вить код на PDP-8, пробивая перфокарты на телетайпе, поддерживающем 

скорость 10 символов в секунду, вам также могут понадобиться сутки, чтобы 

оправиться от разочарования . Но потом и вы смогли бы писать код . Сам код 

мало бы изменился при этом .

В этом весь секрет: неизменность принципов программирования — вот при-

чина общности правил построения программных архитектур для систем 

самых разных типов . Правила определяют последовательность и порядок 

компоновки программ из строительных блоков . И поскольку сами стро-

ительные блоки являются универсальными и не изменились с течением 

времени, правила их компоновки также являются универсальными и по-

стоянными .

Начинающие программисты могут подумать, что все это чепуха, что в наши 

дни все совсем иначе и лучше, что правила прошлого остались в прошлом . 

Если они действительно так думают, они, к сожалению, сильно ошибаются . 

Правила не изменились . Несмотря на появление новых языков, фреймвор-

ков и парадигм, правила остались теми же, как во времена, когда в 1946-м 

Алан Тьюринг написал первый программный код .

Изменилось только одно: тогда, в прошлом, мы не знали этих правил . Поэто-

му нарушали их снова и снова . Теперь, с полувековым опытом за плечами, 

мы знаем и понимаем правила .

Именно об этих правилах — не стареющих и не изменяющихся — расска-

зывает эта книга .

1 Именно «ее», потому что в те годы программистами были в основном женщины .

Благодарности

Ниже перечислены все (не в каком-то определенном порядке), кто сыграл 

важную роль в создании этой книги:

Крис Гузиковски (Chris Guzikowski)

Крис Зан (Chris Zahn)

Мэтт Хойзер (Matt Heuser)

Джефф Оверби (Jeff Overbey)

Мика Мартин (Micah Martin)

Джастин Мартин (Justin Martin)

Карл Хикман (Carl Hickman)

Джеймс Греннинг (James Grenning)

Симон Браун (Simon Brown)

Кевлин Хенни (Kevlin Henney)

Джейсон Горман (Jason Gorman)

Дуг Бредбери (Doug Bradbury)

Колин Джонс (Colin Jones)

Гради Буч (Grady Booch)

Кент Бек (Kent Beck)

Мартин Фаулер (Martin Fowler)

Алистер Кокберн (Alistair Cockburn)

Джеймс О . Коплиен  

(James O . Coplien)

Тим Конрад (Tim Conrad)

Ричард Ллойд (Richard Lloyd)

Кен Финдер (Ken Finder)

Крис Ивер (Kris Iyer (CK))

Майк Карев (Mike Carew)

Джерри Фицпатрик  

(Jerry Fitzpatrick)

Джим Ньюкирк (Jim Newkirk)

Эд Телен (Ed Thelen)

Джо Мейбл (Joe Mabel)

Билл Дегнан (Bill Degnan)

И многие другие .

Когда я просматривал книгу в окончательном варианте и перечитывал 

главу о кричащей архитектуре, передо мной стоял образ улыбающегося 

Джима Уэри ча (Jim Weirich) и в ушах слышался его звонкий смех . Удачи 

тебе, Джим!

Об авторе

Роберт С. Мартин (Robert C . Martin), из-

вестный также как «дядюшка Боб» (Uncle 

Bob), профессионально занимается про-

граммированием с 1970 года . Соосно-

ватель компании cleancoders.com, предла-

гающей видеоуроки для разработчиков 

программного обеспечения, и основатель 

компании Uncle Bob Consulting LLC, оказы-

вающей консультационные услуги и услуги по обучению персонала круп-

ным корпорациям . Служит мастером в консалтинговой фирме 8th Light, Inc . 

в городе Чикаго . Опубликовал десятки статей в специализированных жур-

налах и регулярно выступает на международных конференциях и демон-

страциях . Три года был главным редактором журнала C++ Report и первым 

председателем Agile Alliance .

Мартин написал и выступил редактором множества книг, включая The Clean 

Coder1, Clean Code2, UML for Java Programmers, Agile Software Development3, 

Extreme Programming in Practice, More C++ Gems, Pattern Languages of Program 

Design 3 и Designing Object Oriented C++ Applications Using the Booch Method» .

1 Роберт Мартин. Идеальный программист . Как стать профессионалом разработки ПО . 

СПб .: Питер, 2016 . — Примеч. пер.

2 Роберт Мартин. Чистый код: создание, анализ и рефакторинг . СПб .: Питер, 2013 . — 

Примеч. пер.

3 Роберт Мартин. Быстрая разработка программ . Принципы, примеры, практика . М .: 

Виль ямс, 2004 . — Примеч. пер.

I   

Введение

Чтобы написать действующую программу, не нужно много знать и уметь . 

Дети в школе делают это постоянно . Юноши и девушки в колледжах на-

чинают свой бизнес, вырастающий до стоимости в миллиарды долларов, 

написав несколько строк кода на PHP или Ruby . Начинающие программи-

сты в офисах по всему миру перелопачивают горы требований, хранящихся 

в гигантских баг-трекерах, и вносят исправления, чтобы заставить свои 

системы «работать» . Возможно, они пишут не самый лучший код, но он ра-

ботает . Он работает, потому что заставить что-то работать — один раз — не 

очень сложно .

Создать программу, которая будет работать правильно, — совсем другое 

дело . Написать правильную программу сложно . Для этого необходимы зна-

ния и умения, которые молодые программисты еще не успели приобрести . 

А чтобы приобрести их, требуется мыслить и анализировать, на что у многих 

программистов просто нет времени . Это требует такой самодисциплины 

и организованности, которые не снились большинству программистов . 

А для этого нужно испытывать страсть к профессии и желание стать про-

фессионалом .

Но когда создается правильный программный код, происходит что-то 

необычное: вам не требуются толпы программистов для поддержки его 

работоспособности . Вам не нужна объемная документация с требованиями 

и гигантские баг-трекеры . Вам не нужны огромные опенспейсы, работающие 

круглые сутки без выходных .

Правильный программный код не требует больших трудозатрат на свое 

создание и сопровождение . Изменения вносятся легко и быстро . Ошибки 

24   Введение

немногочисленны . Трудозатраты минимальны, а функциональность и гиб-

кость — максимальны .

Да, такое представление кажется утопическим . Но я видел это воочию . 

Я участвовал в проектах, где дизайн и архитектура системы упрощали их 

создание и сопровождение . У меня есть опыт работы в проектах, потребо-

вавших меньшего числа участников, чем предполагалось . Мне довелось 

работать над системами, в которых ошибки встречались удивительно редко . 

Я видел, какой невероятный эффект оказывает хорошая архитектура на 

систему, проект и коллектив разработчиков . Я был на земле обетованной .

Но я не прошу верить мне на слово . Оглянитесь на свой опыт . Случалось ли 

у вас что-то противоположное? Доводилось ли вам работать над системами 

с настолько запутанными и тесными связями, что любое изменение, неза-

висимо от сложности, требовало недель труда и было сопряжено с огромным 

риском? Испытывали ли вы сопротивление плохого кода и неудачного 

дизайна? Приходилось ли вам видеть, как дизайн системы оказывал отрица-

тельное влияние на моральный дух команды, доверие клиентов и терпение 

руководителей? Доводилось ли вам оказываться в ситуации, когда отделы, 

подразделения и целые компании становились жертвами неудачной архи-

тектуры их программного обеспечения? Были ли в аду программирования?

Я был, и многие из нас были там . В нашей среде чаще встречается опыт 

борьбы с плохим дизайном, чем получение удовольствия от воплощения 

хорошо продуманной архитектуры .

1

Что такое дизайн 

и архитектура?

26   Глава 1. Что такое дизайн и архитектура?

За долгие годы вокруг понятий «дизайн» и «архитектура» накопилось 

много путаницы . Что такое дизайн? Что такое архитектура? Чем они раз-

личаются?

Одна из целей этой книги — устранить весь этот беспорядок и определить 

раз и навсегда, что такое дизайн и архитектура . Прежде всего, я утверждаю, 

что между этими понятиями нет никакой разницы . Вообще никакой .

Слово «архитектура» часто используется в контексте общих рассуждений, 

когда не затрагиваются низкоуровневые детали, а слово «дизайн» обычно 

подразумевает организацию и решения на более низком уровне . Но такое 

разделение бессмысленно, когда речь идет о том, что делает настоящий 

архитектор .

Возьмем для примера архитектора, спроектировавшего мой новый дом . 

Этот дом имеет архитектуру? Конечно! А в чем она выражается? Ну . . . это 

форма дома, внешний вид, уступы, а также расположение комнат и органи-

зация пространства внутри . Но когда я рассматривал чертежи, созданные 

архитектором, я увидел на них массу деталей . Я увидел расположение всех 

розеток, выключателей и светильников . Я увидел, какие выключатели будут 

управлять теми или иными светильниками . Я увидел, где будет находиться 

узел отопления, а также местоположение и размеры водонагревательного 

котла и насоса . Я увидел подробное описание, как должны конструироваться 

стены, крыша и фундамент .

Проще говоря, я увидел все мелкие детали, поддерживающие все высоко-

уровневые решения . Я также увидел, что низкоуровневые детали и высоко-

уровневые решения вместе составляют дизайн дома .

То же относится к архитектуре программного обеспечения . Низкоуровне-

вые детали и высокоуровневая структура являются частями одного целого . 

Они образуют сплошное полотно, определяющее форму системы . Одно без 

другого невозможно; нет никакой четкой линии, которая разделяла бы их . 

Есть просто совокупность решений разного уровня детализации .

Цель?

В чем состоит цель таких решений, цель хорошего дизайна программного 

обеспечения? Главная цель — не что иное, как мое утопическое описание:

Цель архитектуры программного обеспечения — уменьшить человеческие 

трудозатраты на создание и сопровождение системы.

Пример из практики      27

Мерой качества дизайна может служить простая мера трудозатрат, необ-

ходимых для удовлетворения потребностей клиента . Если трудозатраты 

невелики и остаются небольшими в течение эксплуатации системы, систе-

ма имеет хороший дизайн . Если трудозатраты увеличиваются с выходом 

каждой новой версии, система имеет плохой дизайн . Вот так все просто .

Пример из практики

В качестве примера рассмотрим результаты исследований из практики . Они 

основаны на реальных данных, предоставленных реальной компанией, по-

желавшей не разглашать своего названия .

Сначала рассмотрим график роста численности инженерно-технического 

персонала . Вы наверняка согласитесь, что тенденция впечатляет . Рост чис-

ленности, как показано на рис . 1 .1, должен служить признаком успешного 

развития компании!

Жизненный цикл известного программного продукта

1 

2 

3 

4 

5 

6 

7 

8

Инженерно-

технический 

персонал

1400

1200

1000

800

600

400

200

0

Рис. 1.1. Рост численности инженерно-технического персонала. 

Воспроизводится с разрешения автора презентации Джейсона Гормана  

(Jason Gorman)

Теперь взгляните на график продуктивности компании за тот же период, 

измеряемой в количестве строк кода (рис . 1 .2) .

28   Глава 1. Что такое дизайн и архитектура?

1 

2 

3 

4 

5 

6 

7 

8

8000

7000

6000

5000

4000

3000

2000

1000

0

Размер 

продукта 

(тысяч строк)

Жизненный цикл известного программного продукта

Рис. 1.2. Продуктивность за тот же период

Очевидно, что здесь что-то не так . Даже при том, что выпуск каждой версии 

поддерживается все большим количеством разработчиков, похоже, что ко-

личество строк кода приближается к своему пределу .

А теперь взгляните на по-настоящему удручающий график: на рис . 1 .3 по-

казан рост стоимости строки кода с течением времени .

1 

2 

3 

4 

5 

6 

7 

8

Стоимость 

строки кода

Версия 

Жизненный цикл известного программного продукта

400

350

300

250

200

150

100

50

0

Рис. 1.3. Изменение стоимости строки кода с течением времени

Пример из практики      29

Эта тенденция говорит о нежизнеспособности . Какой бы рентабельной ни 

была компания в настоящее время, растущие накладные расходы поглотят 

прибыль и приведут ее к застою, если не к краху .

Чем обусловлено такое значительное изменение продуктивности? Почему 

строка кода в версии 8 продукта стоит в 40 раз дороже, чем в версии 1?

Причины неприятностей

Причины неприятностей перед вашими глазами . Когда системы созда-

ются второпях, когда увеличение штата программистов — единственный 

способ продолжать выпускать новые версии и когда чистоте кода или 

дизайну уделяется минимум внимания или не уделяется вообще, можно 

даже не сомневаться, что такая тенденция рано или поздно приведет 

к краху .

На рис . 1 .4 показано, как выглядит эта тенденция применительно к продук-

тивности разработчиков . Сначала разработчики показываю продуктивность, 

близкую к 100%, но с выходом каждой новой версии она падает . Начиная 

с четвертой версии, как нетрудно заметить, их продуктивность приближа-

ется к нижнему пределу — к нулю .

1 

2 

3 

4 

5 

6 

7 

8

Продуктивность

Изменение продуктивности с выпуском новых версий

100%

75%

50%

25%

0%

Рис. 1.4. Изменение продуктивности с выпуском новых версий

С точки зрения разработчиков, такая ситуация выглядит очень удручающе, 

потому все они продолжают трудиться с полной отдачей сил . Никто не от-

лынивает от работы .

30   Глава 1. Что такое дизайн и архитектура?

И все же, несмотря на сверхурочный труд и самоотверженность, они просто 

не могут произвести больше . Все их усилия теперь направлены не на реали-

зацию новых функций, а на борьбу с беспорядком . Большую часть времени 

они заняты тем, что переносят беспорядок из одного места в другое, раз за 

разом, чтобы получить возможность добавить еще одну мелочь .

Точка зрения руководства

Если вы думаете, что ситуация скверная, взгляните на нее с точки зрения 

руководства! На рис . 1 .5 изображен график изменения месячного фонда 

оплаты труда разработчиков за тот же период .

1 

2 

3 

4 

5 

6 

7 

8

Месячный фонд оплаты труда

Версия

$20 000 000

$15 000 000

$10 000 000

$5 000 000

Рис. 1.5. Изменение фонда оплаты труда разработчиков  

с выпуском новых версий

Когда была выпущена версия 1, месячный фонд оплаты труда составлял не-

сколько сотен тысяч долларов . К выпуску второй версии фонд увеличился 

еще на несколько сотен тысяч . К выпуску восьмой версии месячный фонд 

оплаты труда составил 20 миллионов долларов и тенденция к увеличению 

сохраняется .

Этот график выглядит не просто скверно, он пугает . Очевидно, что про-

исходит что-то ужасное . Одна надежда, что рост доходов опережает рост 

затрат, а значит, оправдывает расходы . Но с любой точки зрения эта кривая 

вызывает беспокойство .

А теперь сравните кривую на рис . 1 .5 с графиком роста количества строк 

кода от версии к версии на рис . 1 .2 . Сначала, всего за несколько сотен тысяч 

долларов в месяц, удалось реализовать огромный объем функциональности, 

Пример из практики      31

а за 20 миллионов в последнюю версию почти ничего не было добавлено! 

Любой менеджер, взглянув на эти два графика, придет к выводу, что необ-

ходимо что-то предпринять, чтобы предотвратить крах .

Но что можно предпринять? Что пошло не так? Что вызвало такое неверо-

ятное снижение продуктивности? Что могут сделать руководители, кроме 

как топнуть ногой и излить свой гнев на разработчиков?

Что не так?

Примерно 2600 лет тому назад Эзоп сочинил басню о Зайце и Черепахе . 

Мораль той басни можно выразить по-разному:

 

� «медленный и постоянный побеждает в гонке»;

 

� «в гонке не всегда побеждает быстрейший, а в битве — сильнейший»;

 

� «чем больше спешишь, тем меньше успеваешь» .

Притча подчеркивает глупость самонадеянности . Заяц был настолько уве-

рен в своей скорости, что не отнесся всерьез к состязанию, решил вздрем-

нуть и проспал, когда Черепаха пересекла финишную черту .

Современные разработчики также участвуют в похожей гонке и проявляют 

похожую самонадеянность . О нет, они не спят, нет . Многие современные 

разработчики работают как проклятые . Но часть их мозга действительно 

спит — та часть, которая знает, что хороший, чистый, хорошо проработанный 

код играет немаловажную роль .

Эти разработчики верят в известную ложь: «Мы сможем навести по-

рядок потом, нам бы только выйти на рынок!» В результате порядок так 

и не наводится, потому что давление конкуренции на рынке никогда не 

ослабевает . Выход на рынок означает, что теперь у вас на хвосте висят 

конкуренты и вы должны стремиться оставаться впереди них и бежать 

вперед изо всех сил .

Поэтому разработчики никогда не переключают режим работы . Они 

не могут вернуться и навести порядок, потому что должны реализовать 

следующую новую функцию, а потом еще одну, и еще, и еще . В результате 

беспорядок нарастает, а продуктивность стремится к своему пределу около 

нуля .

Так же как Заяц был излишне уверен в своей скорости, многие разработчи-

ки излишне уверены в своей способности оставаться продуктивными . Но 

32   Глава 1. Что такое дизайн и архитектура?

ползучий беспорядок в коде, иссушающий их продуктивность, никогда не 

спит и не никогда бездействует . Если впустить его, он уменьшит произво-

дительность до нуля за считаные месяцы .

Самая большая ложь, в которую верят многие разработчики, — что грязный 

код поможет им быстро выйти на рынок, но в действительности он затормо-

зит их движение в долгосрочной перспективе . Разработчики, уверовавшие 

в эту ложь, проявляют самонадеянность Зайца, полагая, что в будущем смо-

гут перейти от создания беспорядка к наведению порядка, но они допускают 

простую ошибку . Дело в том, что создание беспорядка всегда оказывается 

медленнее, чем неуклонное соблюдение чистоты, независимо от выбранного 

масштаба времени .

Рассмотрим на рис . 1 .6 результаты показательного эксперимента, проводив-

шегося Джейсоном Горманом в течение шести дней . Каждый день он писал 

от начала до конца простую программу преобразования целых чисел из 

десятичной системы счисления в римскую . Работа считалась законченной, 

когда программа успешно проходила предопределенный комплект приемоч-

ных тестов . Каждый день на решение поставленной задачи затрачивалось 

чуть меньше 30 минут . В первый, второй и третий дни Джейсон использовал 

1 

2 

3

С применением TDD

Без применения TDD

Итерации

Упражнение по преобразованию в римские числа

Время 

выполнения 

(мин.)

30

29

28

27

26

25

24

23

22

Рис. 1.6. Время на выполнение итерации с использованием и без использования 

методики TDD

Заключение      33

хорошо известную методику разработки через тестирование (Test-Driven 

Development; TDD) . В остальные дни он писал код, не ограничивая себя 

рамками этой методики .

Прежде всего обратите внимание на кривую обучения, заметную на рис . 1 .6 . 

Каждый раз на решение задачи затрачивалось меньше времени . Отметьте 

также, что в дни, когда применялась методика TDD, упражнение выполня-

лось примерно на 10% быстрее, чем в дни без применения TDD, и что даже 

худший результат, полученный с TDD, оказался лучше самого лучшего 

результата, полученного без TDD .

Кто-то, взглянув на этот результат, может посчитать его удивительным . Но 

для тех, кто не поддался обману самонадеянности Зайца, результат будет 

вполне ожидаемым, потому что они знают простую истину разработки про-

граммного обеспечения:

Поспешай не торопясь.

И она же является ответом на дилемму, стоящую перед руководством . 

Единственный способ обратить вспять снижение продуктивности и уве-

личение стоимости — заставить разработчиков перестать думать как само-

надеянный Заяц и начать нести ответственность за беспорядок, который 

они учинили .

Разработчики могут подумать, что проблему можно исправить, только на-

чав все с самого начала и перепроектировав всю систему целиком, — но это 

в них говорит все тот же Заяц . Та же самонадеянность, которая прежде уже 

привела к беспорядку, теперь снова говорит им, что они смогут построить 

лучшую систему, если только вновь вступят в гонку . Однако в действитель-

ности все не так радужно:

Самонадеянность, управляющая перепроектированием, приведет к тому же 

беспорядку, что и прежде.

Заключение

Любой организации, занимающейся разработкой, лучше всего избегать 

самона деянных решений и с самого начала со всей серьезностью отнестись 

к качеству архитектуры ее продукта .

34   Глава 1. Что такое дизайн и архитектура?

Серьезное отношение к архитектуре программного обеспечения подразуме-

вает знание о том, что такое хорошая архитектура . Чтобы создать систему, 

дизайн и архитектура которой способствуют уменьшению трудозатрат 

и увеличению продуктивности, нужно знать, какие элементы архитектуры 

ведут к этому .

Именно об этом рассказывается в данной книге . В ней рассказывается, как 

выглядит добротная, чистая архитектура и дизайн, чтобы разработчики 

могли создавать системы, способные приносить прибыль долгое время .

2 История о двух ценностях

36   Глава 2. История о двух ценностях

Всякая программная система имеет две разные ценности: поведение и струк-

туру . Разработчики отвечают за высокий уровень обеих этих ценностей . Но, 

к сожалению, они часто сосредоточиваются на чем-то одном, забывая про 

другое . Хуже того, они нередко сосредоточиваются на меньшей из двух цен-

ностей, что в конечном итоге обесценивает систему .

Поведение

Первая ценность программного обеспечения — его поведение . Програм-

мистов нанимают на работу, чтобы они заставили компьютеры экономить 

деньги или приносить прибыль заинтересованной стороне . Для этого 

мы помогаем заинтересованным сторонам разработать функциональную 

специ фикацию или документ с требованиями . Затем пишем код, застав-

ляющий компьютеры заинтересованных сторон удовлетворять этим тре-

бованиям .

Когда компьютер нарушает требования, программисты вынимают свои от-

ладчики и исправляют проблему .

Многие программисты полагают, что этим их работа ограничивается . Они 

уверены, что их задача — заставлять компьютеры соответствовать требова-

ниям и исправлять ошибки . Они жестоко ошибаются .

Архитектура

Вторая ценность программного обеспечения заключена в самом названии 

«программное обеспечение» . Слово «обеспечение» означает «продукт»; 

а слово «программное»… Как раз в нем и заключается вторая ценность .

Идея программного обеспечения состоит в том, чтобы дать простую возмож-

</p>
   </article>
</body>
</html>
