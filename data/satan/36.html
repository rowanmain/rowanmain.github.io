<!DOCTYPE html>
<html>
<head>
   <title>Моя статья</title>
   <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<style>
body {
   background-color: #f0f0f0;
   font-family: Arial, sans-serif;
}

header {
   background-color: #333;
   color: white;
   padding: 10px;
   text-align: center;
}

h1 {
   margin: 0;
}

article {
   margin: 20px;
}

h2 {
   color: #333;
}

p {
   line-height: 1.6;
}
</style>
<body>
   <header>
       <h1>статья</h1>
   </header>
   <article>
       <p>
к одним изменениям и невосприимчивые к другим . Некоторые из компо-

нентов изначально проектируются как изменчивые . То есть мы ожидаем, 

что они будут изменяться .

Компоненты, с большим трудом поддающиеся изменению, не должны за-

висеть от любых изменчивых компонентов . Иначе изменчивый компонент 

тоже трудно будет изменять .

Это одна из превратностей программного обеспечения, когда модуль, проек-

тировавшийся специально, чтобы упростить возможность изменений, стано-

вится сложно изменять просто из-за того, что от него зависит другой модуль . 

Представьте: вы не изменили ни строчки кода в своем модуле, и вдруг его 

130   Глава 14. Сочетаемость компонентов

стало сложно изменять . Следуя принципу устойчивых зависимостей (Stable 

Dependencies Principle; SDP), мы гарантируем, что модули, с трудом под-

дающиеся изменению, не будут зависеть от модулей, спроектированных для 

упрощения изменений .

Устойчивость

Что подразумевается под «устойчивостью»? Представьте себе монету, 

стоящую на ребре . Является ли такое ее положение устойчивым? Скорее 

всего, вы ответите «нет» . Однако если оградить ее от вибраций и дунове-

ний ветра, она может оставаться в таком положении сколь угодно долго . 

То есть устойчивость напрямую не связана с частотой изменений . Монета 

не изменяется, но едва ли кто-то скажет, что, стоя на ребре, она находится 

в устойчивом положении .

В толковом словаре говорится, что устойчивость — это «способность со-

хранять свое состояние при внешних воздействиях» . Устойчивость связана 

с количеством работы, которую требуется проделать, чтобы изменить со-

стояние . С одной стороны, монета, стоящая на ребре, находится в неустой-

чивом состоянии, потому что требуется приложить крошечное усилие, 

чтобы опрокинуть ее . С другой стороны, стол находится в очень устойчивом 

состоянии, потому что для его опрокидывания требуются намного более 

существенные усилия .

Какое отношение все это имеет к программному обеспечению? Существует 

множество факторов, усложняющих изменение компонента, например его 

размер, сложность и ясность . Но мы оставим в стороне все эти факторы и со-

средоточим внимание на кое-чем другом . Есть один верный способ сделать 

программный компонент сложным для изменения — создать много других 

компонентов, зависящих от него . Компонент с множеством входящих за-

висимостей очень устойчив, потому что согласование изменений со всеми 

зависящими компонентами требует значительных усилий .

На рис . 14 .5 представлена диаграмма с устойчивым компонентом X . От него 

зависят три других компонента, то есть имеется три веские причины не 

изменять его . Мы говорим, что X несет ответственность за эти три компо-

нента . Сам компонент X, напротив, ни от чего не зависит, то есть на него не 

оказывается никаких внешних воздействий, которые могли бы привести 

к изменению . Мы говорим, что он независим .

На рис . 14 .6 изображен очень неустойчивый компонент Y . От него не зависит 

никакой другой компонент, поэтому мы говорим, что он лишен ответствен-

ности . Имеется также три компонента, от которых зависит Y, поэтому необ-

Принцип устойчивых зависимостей      131

ходимость его изменения может проистекать из трех внешних источников . 

Мы говорим, что Y зависим .

Рис. 14.5. X: устойчивый компонент

Рис. 14.6. Y: очень неустойчивый компонент

Метрики устойчивости

Как оценить устойчивость компонента? Один из способов — подсчитать 

количество входящих и исходящих зависимостей этого компонента . Эти 

числа позволят вычислить меру его устойчивости .

 

� Fan-in (число входов): количество входящих зависимостей . Эта метрика 

определяет количество классов вне данного компонента, которые зависят 

от классов внутри компонента .

 

� Fan-out (число выходов): количество исходящих зависимостей . Эта ме-

трика определяет количество классов внутри данного компонента, за-

висящих от классов за его пределами .

 

� I: неустойчивость: I = Fan-out ÷ (Fan-in + Fan-out) . Значение этой метрики 

изменяется в диапазоне [0, 1] . I = 0 соответствует максимальной устой-

чивости компонента, I = 1 — максимальной неустойчивости .

132   Глава 14. Сочетаемость компонентов

Метрики Fan-in (число входов) и Fan-out (число выходов)1 определяются 

как количество классов за пределами компонентов, связанных зависимо-

стями с классами внутри компонента . Рассмотрим пример, изображенный 

на рис . 14 .7 .

Рис. 14.7. Пример

Рассчитаем устойчивость компонента Cc . Вне компонента Cc имеется три 

класса, зависящих от классов внутри Cc . То есть Fan-in = 3 . Кроме того, вне 

Cc имеется один класс, от которого зависят классы внутри Cc . То есть Fan-

out = 1 и I = 1/4 .

В C++ эти зависимости обычно представлены инструкциями #include . 

В действительности метрику I проще вычислять, когда исходный код орга-

низован так, что каждый класс хранится в отдельном файле . В Java метри-

ку I можно вычислить, подсчитав количество инструкций import и полных 

квалифицированных имен .

Если метрика I равна 1, это означает, что никакой другой компонент не за-

висит от данного компонента (Fan-in = 0) и данный компонент зависит от 

других компонентов (Fan-out > 0) . Это признак неустойчивости компонента; 

он безответствен и зависим . Отсутствие зависящих компонентов означает, 

что он не может служить причиной изменения других компонентов, а его 

собственная зависимость может послужить веским основанием для изме-

нения самого компонента .

Напротив, когда метрика I равна 0, это означает, что от компонента зависят 

другие компоненты (Fan-in > 0), но сам он не зависит от других компонентов 

(Fan-out = 0) . Такой компонент ответствен и независим . Он занимает макси-

1 В предыдущих публикациях я использовал для связей имена Efferent (центробежный) 

и Afferent (центростремительный), Ce и Ca, вместо Fan-out и Fan-in соответственно . 

Это был всего лишь каприз с моей стороны: мне нравилось сравнение с центральной 

нервной системой .

Принцип устойчивых зависимостей   133

мально устойчивое положение. Зависимости от него усложняют изменение 

</p>
   </article>
</body>
</html>
