<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>book</title></head><body>ваше приложение к фреймворку настолько, насколько это возможно .

Для автора тесная связь с его собственным фреймворком не является про-

блемой . Для автора такая связь желательна, потому что он обладает абсо-

лютным контролем над этим фреймворком .

Более того, автор хочет привязать вас к фреймворку, потому что, привя-

завшись, будет очень трудно отвязаться . Ничто не подтверждает авторитет 

280   Глава 32. Фреймворки — это деталь

автора так, как группа пользователей, готовых порождать свои классы на 

основе базовых классов автора .

Фактически автор предлагает вам вступить в союз с фреймворком — вы-

разить ему большую и долговременную приверженность . Но при этом сам 

автор ни при каких обстоятельствах не выражает ответной приверженности 

вам . Это однонаправленный союз . Вы принимаете на себя все риски и не-

удобства; автор фреймворка не берет на себя ничего .

Риски

Какие риски, спросите вы? Вот лишь некоторые из них .

 

� Часто архитектура фреймворков не отличается особой чистотой . Фрейм-

воркам свойственно нарушать правило зависимости . Авторы предлагают 

вам наследовать их код в ваших бизнес-объектах — ваших сущностях! 

Они хотят внедрить свои фреймворки в самый внутренний круг . Как 

только это произойдет, убрать фреймворк оттуда будет почти невозмож-

но . Надев обручальное кольцо на палец, он останется жить там .

 

� Фреймворк может помочь с реализацией первых возможностей при-

ложения . Однако, достигнув некоторого уровня зрелости, ваш продукт 

перерастет фреймворк . Если вы надели это обручальное кольцо, то 

со временем заметите, что вам все чаще и чаще приходится бороться 

с фреймворком .

 

� Фреймворк может развиваться в направлении, бесполезном для вас . Вы 

можете столкнуться с необходимостью обновления до следующей версии, 

не несущей ничего, что могло бы пригодиться вам . Вы можете даже об-

наружить, что старые особенности, которыми вы пользовались, исчезают 

или изменяются так, что вам трудно поспевать за ними .

 

� Может появиться новый, более удачный фреймворк, на который вы за-

хотите перейти .

Решение

И каково решение?

Не заключать союзов с фреймворками!

О, вы можете использовать фреймворк — просто не привязывайтесь к нему . 

Держите его на расстоянии вытянутой руки . Рассматривайте фреймворк 

Заключение      281

как деталь, принадлежащую одному из внешних кругов архитектуры . Не 

впускайте его во внутренние круги .

Если фреймворк предложит вам породить свои бизнес-объекты от его 

базовых классов, скажите «нет»! Определите прокси-классы и держите их 

в компонентах, являющихся плагинами для ваших бизнес-правил .

Не позволяйте фреймворкам проникать в ваш основной код . Внедряйте их 

в компоненты, которые лишь подключаются к вашему основному коду, как 

того требует правило зависимости .

Например, возможно, вам нравится Spring — хороший фреймворк внедрения 

зависимостей . Возможно, вы используете Spring для автоматического вне-

дрения своих зависимостей . Это замечательно, но вы не должны окроплять 

аннотациями @autowired свои бизнес-объекты . Бизнес-объекты не должны 

знать о существовании Spring .

Но вы с успехом можете использовать Spring для внедрения зависимостей 

в своем компоненте Main . Этот компонент может знать о фреймворке Spring, 

потому что он является самым грязным и самым низкоуровневым компо-

нентом в системе .

Объявляю вас

Есть некоторые фреймворки, с которыми вы просто обязаны вступить 

в союз . Если, например, вы пишете на C++, вам почти наверняка придется 

вступить в союз с STL — избежать этого очень сложно . Если вы пишете на 

Java, вы будете вынуждены вступить в союз со стандартной библиотекой .

Это нормально — но все равно это должно быть осознанное решение . Вы 

должны понимать, что, заключив союз между фреймворком и вашим при-

ложением, вам придется придерживаться этого фреймворка в течение всего 

жизненного цикла этого приложения . В радости и в горе, в болезни и в здо-

ровье, в богатстве и в бедности, отказавшись от всех остальных, вы будете 

использовать этот фреймворк . Этот шаг нельзя делать по легкомыслию .

Заключение

Встретившись с фреймворком, не торопитесь вступать с ним в союз . По-

смотрите, есть ли возможность отложить решение . Если это возможно, 

удерживайте фреймворк за архитектурными границами . Может быть, вам 

удастся найти способ получить молоко, не покупая корову .

33

Практический пример: 

продажа видео

Анализ вариантов использования      283

Теперь самое время объединить изученные нами правила и принципы 

создания архитектур и применить их для реализации учебного примера . 

Пример будет коротким и простым, но его будет вполне достаточно, чтобы 

продемонстрировать процесс, которому следует хороший архитектор, и при-

нимаемые им решения .

Продукт

Для этого примера я выбрал продукт, с которым довольно близко знаком: 

программное обеспечение для веб-сайта, продающего видеоматериалы . 

Да, он напоминает cleancoders.com — сайт, где я продаю свои обучающие 

видеофильмы .

Основная идея проста . У нас есть партия видеофильмов, которые требуется 

продать . Мы продаем их через Веб физическим лицам и компаниям . Физи-

ческие лица могут заплатить одну, более низкую, цену за потоковое видео, 

или другую, более высокую, за загрузку копий и их постоянное использо-

вание . Бизнес-лицензии распространяются только на потоковую доставку 

и приобретаются партиями, что позволяет предоставлять скидки .

Физические лица обычно выступают в роли зрителей или покупателей . 

В компаниях, напротив, есть люди, которые покупают видеофильмы для 

просмотра другими .
</body></html>